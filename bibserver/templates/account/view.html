{% extends "base.html" %}

{% block content %}

<script type="text/javascript">
jQuery(document).ready(function() {
    jQuery('#panel').facetview( {{ search_options | safe }} )
});
</script>

{% if admin %}

    <script type="text/javascript">
    jQuery(document).ready(function() {
        jQuery('#user').jtedit({
            "data": {{ record | safe }}, 
            "hide": ["api_key","_created","_last_modified","_id"], 
            "target": "#",
            "delete_redirect": "/"
        })
    });
    </script>

    <div class="hero-unit clearfix">
        <div class="span5">
            <h2>Hi {{ current_user.id }}</h2>
            <p>{{ current_user.description }}</p>
            <p><br />Your api_key is:<p>
            <p> {{current_user['api_key']}}</p>
            <p>You need to append this to your API calls if you want to make changes.</p>
            {% if superuser %}
                <p>You are the superuser! You can view and edit anything!
                <br />Be careful...</p>
            {% endif %}
        </div>
        <div id="user" class="span5">
            <h2>Edit your details</h2>
        </div>
    </div>

    <div class="row">
        <div class="span3">
            <h3>Your collections</h3>
            <p>You have {{ recordcount }} records across {{ collcount }} collections. Choose one to view - admin options are available in each collection.</p>
            {% if current_user['collections']|length == 0 %}
            <p>You have no collections yet. <a href="/upload">Create one!</a></p>
            {% else %}
            {% for coll in current_user['collections'] %}
                <p><a href="/{{current_user.id}}/{{coll.collection}}">{{coll['label']}}</a> -  
                {{coll['description']}} ({{coll|length}} records)</p>
            {% endfor %}
            {% endif %}
        </div>
        <div id="panel" class="span9">
            <h3>All your records</h3>
        </div>
    </div>

{% else %}

    <div class="hero-unit clearfix">
        <div class="span6">
            <h2>{{ account.id }}</h2>
            <p>{{ account.description }}</p>
        </div>
        <div class="span4">
            <p>You are not logged in as this user. Use the <a href="/account/login">login page</a> if you want to change this</p>
        </div>
    </div>
    
    <div class="row">
        <div id="panel" class="span12">
        </div>
    </div>

{% endif %}

{% endblock %}

